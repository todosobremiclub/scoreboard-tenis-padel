<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Administrador — Scoreboard Tenis/Pádel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="/style.css">

  <!-- Estilos mínimos extra -->
  <style>
    /* === Tabs superiores (Jugadores / Torneos / Partidos) === */
    .top-tabs {
      display: flex; gap: 10px; margin: 10px 0 14px; flex-wrap: wrap;
    }
    .top-tab {
      padding: 10px 14px; border-radius: 8px; cursor: pointer;
      background: #0f4b38; border: 2px solid #093628; color: #f1f1f1;
      font-weight: 900; letter-spacing: .2px; user-select: none;
    }
    .top-tab.active { background: #1a5c45; }

    /* === Tabs internos existentes de Partidos (se mantienen) === */
    .tabs {
      display: flex; gap: 8px; margin: 8px 0 12px;
      flex-wrap: wrap;
    }
    .tab {
      padding: 8px 12px; border-radius: 4px; cursor: pointer;
      background: #0f4b38; border: 2px solid #093628; color: #f1f1f1;
      font-weight: 700;
    }
    .tab.active { background: #1a5c45; }

    .filterbar {
      display: grid;
      grid-template-columns: 1fr 220px 220px auto;
      gap: 10px; margin-bottom: 12px;
    }
    .filterbar input, .filterbar select {
      padding: 8px; background: #0f4b38; color: #f1f1f1; border: 1px solid #093628;
    }
    .list { display: grid; gap: 10px; }
    .badge {
      display: inline-block; padding: 2px 8px; font-size: 12px; border-radius: 100px;
      background: #0f4b38; border: 1px solid #093628; color: #e1d36e; margin-right: 6px;
    }
    .muted { color: #cfd8d3; font-size: 13px; }
    .wrap { display: flex; flex-wrap: wrap; gap: 8px; }
    .match-title { font-size: 20px; font-weight: 800; margin: 2px 0; }
    .teams-line { font-size: 16px; }
    .actions .btn {
      background: #1a5c45; color: #fff; border: 1px solid #093628;
      padding: 8px 10px; border-radius: 4px; cursor: pointer; font-weight: 700;
    }
    .actions .btn:disabled { opacity: .5; cursor: not-allowed; }
    .right { margin-left: auto; }
    @media (max-width: 900px){
      .filterbar { grid-template-columns: 1fr 1fr; }
    }

    /* Helpers de visibilidad para top tabs */
    .section { display: none; }
    .section.active { display: block; }
  </style>
</head>
<body>
  <!-- =========================
       LOGIN OVERLAY (Admin)
  ========================= -->
  <div id="loginOverlay" style="
    position:fixed; inset:0; background:rgba(0,0,0,.65);
    display:none; align-items:center; justify-content:center; z-index:9999;
  ">
    <div style="
      width:520px; max-width:92vw;
      background:#151a21; border:1px solid #263241; border-radius:14px;
      padding:16px; color:#e6edf3; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;
    ">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
        <h2 style="margin:0; font-size:18px;">Ingreso Admin</h2>
        <span id="loginEnvBadge" style="font-size:12px; color:#8892a6;"></span>
      </div>
      <p style="margin:8px 0 12px; color:#8892a6;">
        Iniciá sesión para acceder a <b>admin.html</b>.
      </p>
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
        <div style="display:grid; gap:6px;">
          <label style="font-size:13px; color:#b6c0d1;">Email</label>
          <input id="adminLoginEmail" type="email" placeholder="usuario@dominio.com" autocomplete="username"
                 style="background:#0e1520;color:#e6edf3;border:1px solid #263241;padding:9px 10px;border-radius:10px;outline:none;">
        </div>
        <div style="display:grid; gap:6px;">
          <label style="font-size:13px; color:#b6c0d1;">Contraseña</label>
          <input id="adminLoginPassword" type="password" placeholder="********" autocomplete="current-password"
                 style="background:#0e1520;color:#e6edf3;border:1px solid #263241;padding:9px 10px;border-radius:10px;outline:none;">
        </div>
        <div style="grid-column:1 / span 2; display:flex; gap:10px; align-items:center; justify-content:flex-end; margin-top:4px;">
          <button id="adminBtnLogin"
                  style="border:1px solid #1f6f2e;background:#238636;color:#e6edf3;padding:9px 12px;border-radius:10px;cursor:pointer;">
            Iniciar sesión
          </button>
        </div>
      </div>
      <div id="adminLoginMsg" style="margin-top:10px; color:#8892a6; font-size:13px;"></div>
    </div>
  </div>

  <!-- Barra mínima de sesión -->
  <div id="adminSessionBar" style="
    position:fixed; right:16px; bottom:16px;
    background:#0c1016; border:1px solid #263241; border-radius:12px;
    padding:10px 12px; color:#e6edf3; display:none; gap:10px; align-items:center; z-index:9998;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;
  ">
    <span id="adminMeLabel" style="font-size:13px; color:#b6c0d1;"></span>
    <button id="adminBtnLogout"
            style="border:1px solid #263241;background:#101826;color:#e6edf3;padding:7px 10px;border-radius:10px;cursor:pointer;">
      Cerrar sesión
    </button>
  </div>

  <!-- =========================
       APP ADMIN (tabs superiores)
  ========================= -->
  <div id="adminApp" style="display:none;">
    <div class="container">
      <h1>Consola de Administración</h1>

      <!-- Top Tabs: Jugadores / Torneos / Partidos -->
      <div class="top-tabs" id="topTabs">
        <div class="top-tab" data-top="players">Jugadores</div>
        <div class="top-tab" data-top="tournaments">Torneos</div>
        <div class="top-tab active" data-top="matches">Partidos</div>
      </div>

      <!-- === Sección: Jugadores (UI nueva tipo grilla) === -->
<section id="playersSection" class="section">
  <div class="form">
    <!-- Header + botón nuevo -->
    <div style="display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap;">
      <h2 style="margin:0;">Jugadores</h2>

      <button
        id="pl_newBtn"
        style="background:#f1c40f;color:#111;border:0;padding:10px 14px;border-radius:8px;font-weight:900;cursor:pointer;"
      >
        Generar nuevo jugador
      </button>
    </div>

    <!-- Filtros -->
    <div class="filterbar" style="grid-template-columns: 1fr 220px 220px auto; margin-top:12px;">
      <input id="pl_q" type="search" placeholder="Buscar por nombre, apellido o DNI..." />

      <select id="pl_filter_cat">
        <option value="">Todas las categorías</option>

        <optgroup label="C">
          <option value="C1">C1</option><option value="C2">C2</option><option value="C3">C3</option>
          <option value="C4">C4</option><option value="C5">C5</option><option value="C6">C6</option>
          <option value="C7">C7</option><option value="C8">C8</option><option value="C9">C9</option>
        </optgroup>

        <optgroup label="D">
          <option value="D1">D1</option><option value="D2">D2</option><option value="D3">D3</option>
          <option value="D4">D4</option><option value="D5">D5</option><option value="D6">D6</option>
          <option value="D7">D7</option><option value="D8">D8</option><option value="D9">D9</option>
        </optgroup>
      </select>

      <label style="display:flex;gap:8px;align-items:center;color:#cfd8d3;font-size:13px;">
        <input id="pl_showInactive" type="checkbox" />
        Ver inactivos
      </label>

      <button id="pl_refreshBtn">Refrescar</button>
    </div>

    <!-- Form colapsable -->
    <div
      id="pl_formWrap"
      style="display:none; margin-top:14px; padding-top:14px; border-top:1px solid rgba(255,255,255,.14);"
    >
      <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;">
        <h3 id="pl_formTitle" style="margin:0;">Nuevo jugador</h3>
        <small class="muted" style="margin:0;">Completá los datos y guardá.</small>
      </div>

      <div class="grid-2" style="margin-top:10px;">
        <div>
          <label>Nombre</label>
          <input id="pl_first" type="text" placeholder="Juan" />
        </div>

        <div>
          <label>Apellido</label>
          <input id="pl_last" type="text" placeholder="Pérez" />
        </div>

        <div>
          <label>DNI</label>
          <input id="pl_dni" type="text" placeholder="12345678" />
        </div>

        <div>
          <label>Teléfono</label>
          <input id="pl_tel" type="text" placeholder="+54 11..." />
        </div>

        <div>
          <label>Fecha de nacimiento</label>
          <input id="pl_birth" type="date" />
        </div>

        <div>
          <label>Edad</label>
          <input id="pl_age" type="number" readonly placeholder="—" />
        </div>

        <div>
          <label>Categoría</label>
          <select id="pl_cat">
            <optgroup label="C">
              <option value="C1">C1</option><option value="C2">C2</option><option value="C3">C3</option>
              <option value="C4">C4</option><option value="C5">C5</option><option value="C6">C6</option>
              <option value="C7">C7</option><option value="C8">C8</option><option value="C9">C9</option>
            </optgroup>
            <optgroup label="D">
              <option value="D1">D1</option><option value="D2">D2</option><option value="D3">D3</option>
              <option value="D4">D4</option><option value="D5">D5</option><option value="D6">D6</option>
              <option value="D7">D7</option><option value="D8">D8</option><option value="D9">D9</option>
            </optgroup>
          </select>
        </div>

        <div>
          <label>Foto</label>
          <input id="pl_photo" type="file" accept="image/*" />
          <small class="muted">JPG/PNG/WebP • Máx 5MB</small>
        </div>
      </div>

      <div class="wrap" style="margin-top:12px;">
        <button id="pl_save">Guardar jugador</button>
        <button id="pl_cancel" class="btn">Cancelar</button>
      </div>
    </div>

    <!-- Tabla de jugadores -->
    <h3 style="margin-top:18px;">Listado</h3>
    <div style="overflow:auto;">
      <table id="playersTable" style="width:100%; border-collapse:collapse;">
        <thead>
          <tr>
            <th>Estado</th>
            <th>DNI</th>
            <th>Nombre</th>
            <th>Apellido</th>
            <th>Categoría</th>
            <th>Teléfono</th>
            <th>Nacimiento</th>
            <th>Edad</th>
            <th>Activo</th>
            <th>Foto</th>
            <th>Opciones</th>
          </tr>
        </thead>
        <tbody id="playersTbody">
          <tr>
            <td colspan="11" class="muted">Sin datos…</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</section>

<!-- === Sección: Torneos (UI real) === -->
<section id="tournamentsSection" class="section">
  <div class="form">
    <!-- Header + botón nuevo -->
    <div style="display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap;">
      <h2 style="margin:0;">Torneos</h2>
      <button
        id="tr_newBtn"
        style="background:#f1c40f;color:#111;border:0;padding:10px 14px;border-radius:8px;font-weight:900;cursor:pointer;"
      >
        Crear nuevo torneo
      </button>
    </div>

    <!-- Filtros -->
    <div class="filterbar" style="grid-template-columns: 1fr 220px 220px auto; margin-top:12px;">
      <input id="tr_q" type="search" placeholder="Buscar por nombre..." />

      <select id="tr_filter_cat">
        <option value="">Todas las categorías</option>
        <optgroup label="C">
          <option value="C1">C1</option><option value="C2">C2</option><option value="C3">C3</option>
          <option value="C4">C4</option><option value="C5">C5</option><option value="C6">C6</option>
          <option value="C7">C7</option><option value="C8">C8</option><option value="C9">C9</option>
        </optgroup>
        <optgroup label="D">
          <option value="D1">D1</option><option value="D2">D2</option><option value="D3">D3</option>
          <option value="D4">D4</option><option value="D5">D5</option><option value="D6">D6</option>
          <option value="D7">D7</option><option value="D8">D8</option><option value="D9">D9</option>
        </optgroup>
      </select>

      <select id="tr_filter_status">
        <option value="">Todos los estados</option>
        <option value="draft">Borrador</option>
        <option value="open">Inscripción abierta</option>
        <option value="running">En curso</option>
        <option value="finished">Finalizado</option>
      </select>

      <button id="tr_refreshBtn">Refrescar</button>
    </div>

    <!-- Form colapsable -->
    <div
      id="tr_formWrap"
      style="display:none; margin-top:14px; padding-top:14px; border-top:1px solid rgba(255,255,255,.14);"
    >
      <div style="display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;">
        <h3 id="tr_formTitle" style="margin:0;">Nuevo torneo</h3>
        <small class="muted" style="margin:0;">Completá los datos y guardá.</small>
      </div>

      <div class="grid-2" style="margin-top:10px;">
        <div>
          <label>Nombre</label>
          <input id="tr_name" type="text" placeholder="Torneo Apertura 2026" />
        </div>

        <div>
          <label>Categoría</label>
          <select id="tr_category">
            <option value="">(Sin categoría)</option>
            <optgroup label="C">
              <option value="C1">C1</option><option value="C2">C2</option><option value="C3">C3</option>
              <option value="C4">C4</option><option value="C5">C5</option><option value="C6">C6</option>
              <option value="C7">C7</option><option value="C8">C8</option><option value="C9">C9</option>
            </optgroup>
            <optgroup label="D">
              <option value="D1">D1</option><option value="D2">D2</option><option value="D3">D3</option>
              <option value="D4">D4</option><option value="D5">D5</option><option value="D6">D6</option>
              <option value="D7">D7</option><option value="D8">D8</option><option value="D9">D9</option>
            </optgroup>
          </select>
        </div>

        <div>
          <label>Formato</label>
          <select id="tr_format">
            <option value="league">Liga (todos contra todos)</option>
            <option value="groups">Grupos</option>
            <option value="knockout">Eliminación directa</option>
          </select>
        </div>

        <div>
          <label>Cantidad de parejas</label>
          <input id="tr_pairs" type="number" min="2" step="1" value="8" />
        </div>

        <div>
          <label>Estado</label>
          <select id="tr_status">
            <option value="draft">Borrador</option>
            <option value="open">Inscripción abierta</option>
            <option value="running">En curso</option>
            <option value="finished">Finalizado</option>
          </select>
        </div>

        <div>
          <label>Fecha</label>
          <input id="tr_date" type="date" />
        </div>
      </div>

      <div class="wrap" style="margin-top:12px;">
        <button id="tr_save">Guardar torneo</button>
        <button id="tr_cancel" class="btn">Cancelar</button>
      </div>
    </div>

    <!-- Tabla -->
    <h3 style="margin-top:18px;">Listado</h3>
    <div style="overflow:auto;">
      <table id="tournamentsTable" style="width:100%; border-collapse:collapse;">
        <thead>
          <tr>
            <th>Estado</th>
            <th>Nombre</th>
            <th>Categoría</th>
            <th>Formato</th>
            <th>Parejas</th>
            <th>Fecha</th>
            <th>Opciones</th>
          </tr>
        </thead>
        <tbody id="tournamentsTbody">
          <tr><td colspan="7" class="muted">Sin datos…</td></tr>
        </tbody>
      </table>
    </div>
  </div>
</section>

      
      <!-- === Sección: Partidos (TU UI ACTUAL) === -->
      <section id="matchesSection" class="section active">
        <!-- Crear partido -->
        <section class="form">
          <h2>Crear partido</h2>
          <div class="grid-2">
            <div>
              <label>Nombre del partido</label>
              <input id="matchName" type="text" value="Partido de prueba">
            </div>
            <div>
              <label>Instancia del partido</label>
              <select id="matchStage">
                <option value="Amistoso" selected>Amistoso</option>
                <option value="Fase de grupos">Fase de grupos</option>
                <option value="32vos de final">32vos de final</option>
                <option value="16vos de final">16vos de final</option>
                <option value="8vos de final">8vos de final</option>
                <option value="4tos de final">4tos de final</option>
                <option value="Semi-Final">Semi-Final</option>
                <option value="Final">Final</option>
              </select>
            </div>
            <div>
              <label>Jugador/Equipo A</label>
              <input id="teamA" type="text" value="Equipo A">
            </div>
            <div>
              <label>Jugador/Equipo B</label>
              <input id="teamB" type="text" value="Equipo B">
            </div>
            <div>
              <label>Saca primero</label>
              <select id="firstServer">
                <option value="A" selected>Equipo A</option>
                <option value="B">Equipo B</option>
              </select>
            </div>
            <div>
              <label>Mejor de (sets)</label>
              <select id="bestOf">
                <option value="1">1</option>
                <option value="3" selected>3</option>
              </select>
            </div>
            <div>
              <label>Tie-break</label>
              <select id="tieBreakAt">
                <option value="6-6" selected>En 6-6</option>
                <option value="5-5">En 5-5 (short set)</option>
                <option value="none">Sin tie-break</option>
              </select>
            </div>
            <div>
              <label>Punto de oro (sin ventajas)</label>
              <select id="noAdvantage">
                <option value="false" selected>No</option>
                <option value="true">Sí</option>
              </select>
            </div>
            <!-- NUEVO: Cancha -->
            <div>
              <label>Cancha</label>
              <input id="courtName" type="text" placeholder="Cancha 1">
            </div>
          </div>
          <div style="margin-top:12px;" class="wrap">
            <button id="createBtn">Crear partido</button>
            <div id="tvUrlWrap" style="display:none;">
              <div><strong>URL para la TV:</strong> <span id="tvUrl"></span></div>
              <small class="muted">Abrí esta URL en la pantalla (Smart TV/Chromecast/PC).</small>
            </div>
          </div>
        </section>

        <!-- Panel de administración de múltiples partidos -->
        <section class="controls">
          <h2>Partidos</h2>
          <!-- Pestañas internas -->
          <div class="tabs" id="tabs">
            <div class="tab active" data-tab="active">Activos</div>
            <div class="tab" data-tab="history">Histórico</div>
          </div>

          <!-- Filtros / búsqueda / ordenar -->
          <div class="filterbar">
            <input id="searchQ" type="search" placeholder="Buscar por partido o equipos..." />
            <select id="filterStage">
              <option value="">Todas las instancias</option>
            </select>
            <select id="sortBy">
              <option value="-createdAt" selected>Más recientes</option>
              <option value="name">Nombre (A-Z)</option>
              <option value="-updatedAt">Última actualización</option>
              <option value="-endedAt">Finalizados (más nuevos)</option>
            </select>
            <button id="refreshBtn">Refrescar</button>
          </div>

          <!-- Listas -->
          <div id="activeList" class="list"></div>
          <div id="historyList" class="list" style="display:none;"></div>
        </section>
      </section>
    </div>

    <!-- Template de ítem de partido -->
    <template id="matchItemTemplate">
      <div class="card match" data-id="">
        <div class="row" style="justify-content: space-between; align-items: flex-start; gap: 12px;">
          <div style="min-width: 260px;">
            <div class="wrap">
              <span class="badge stage">Amistoso</span>
              <span class="badge status">scheduled</span>
            </div>
            <div class="match-title">Partido</div>
            <div class="teams-line">Equipo A vs Equipo B</div>
            <div class="muted meta">
              Saca: <span class="serve">Equipo A</span> •
              Cancha: <span class="court">—</span> •
              Sets: <span class="sets">0-0</span> •
              Games: <span class="games">0-0</span> •
              Points: <span class="points">0-0</span>
            </div>
          </div>
          <div class="right" style="text-align:right; min-width: 220px;">
            <div class="muted">Cronómetro: <span class="elapsed">00:00:00</span></div>
            <div class="muted">Estado: <span class="state">scheduled</span></div>
            <div class="muted">ID: <span class="matchId">—</span></div>
            <div class="muted">Actualizado: <span class="updatedAt">—</span></div>
          </div>
        </div>
        <div class="actions wrap" style="margin-top:10px;">
          <button class="btn btn-open">Abrir TV</button>
          <button class="btn btn-start">Iniciar</button>
          <button class="btn btn-pause">Pausar</button>
          <button class="btn btn-resume">Reanudar</button>
          <button class="btn btn-a">+1 A</button>
          <button class="btn btn-b">+1 B</button>
          <button class="btn btn-reset">Reset game</button>
          <button class="btn btn-toggle-serve">Cambiar saque</button>
          <button class="btn btn-finish">Finalizar</button>
          <button class="btn btn-ads">Publicidad</button>
          <button class="btn btn-edit">Editar</button>
          <button class="btn btn-delete">Eliminar</button>
        </div>
      </div>
    </template>

    <!-- Modal simple para editar partido -->
    <div id="editModal" style="display:none; position: fixed; inset: 0; background: rgba(0,0,0,.6); align-items: center; justify-content: center; z-index: 1000;">
      <div class="card" style="width: min(560px, 92vw);">
        <h3>Editar partido</h3>
        <div class="grid-2">
          <div>
            <label>Nombre del partido</label>
            <input id="editName" type="text">
          </div>
          <div>
            <label>Instancia</label>
            <select id="editStage"></select>
          </div>
          <div>
            <label>Equipo A</label>
            <input id="editTeamA" type="text">
          </div>
          <div>
            <label>Equipo B</label>
            <input id="editTeamB" type="text">
          </div>
          <div>
            <label>Cancha</label>
            <input id="editCourt" type="text">
          </div>
        </div>
        <div class="wrap" style="margin-top: 12px;">
          <button id="editSaveBtn">Guardar</button>
          <button id="editCancelBtn" class="btn">Cancelar</button>
        </div>
      </div>
    </div>

    <!-- Modal de Publicidad -->
    <div id="adsModal" style="display:none; position: fixed; inset: 0; background: rgba(0,0,0,.6); align-items: center; justify-content: center; z-index: 1000;">
      <div class="card" style="width: min(860px, 96vw);">
        <h3>Publicidad del partido</h3>
        <div class="wrap" style="align-items:center; gap:12px;">
          <input id="adsFiles" type="file" accept="image/*" multiple>
          <button id="adsUploadBtn">Subir imágenes</button>
          <span class="muted">Formatos: JPG/PNG/WebP • Máx 10MB por imagen</span>
        </div>
        <div id="adsList" style="margin-top:12px; display:grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 10px;"></div>
        <div class="wrap" style="margin-top: 12px;">
          <button id="adsCloseBtn" class="btn">Cerrar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="/socket.io/socket.io.js"></script>
  <script src="/admin-auth.js"></script>
  <script src="/admin.js"></script>
  <script>
    // Mínimo script para alternar las top-tabs (hasta que reemplacemos admin.js)
    (function(){
      const tabs = document.querySelectorAll('.top-tab');
      const sections = {
        players: document.getElementById('playersSection'),
        tournaments: document.getElementById('tournamentsSection'),
        matches: document.getElementById('matchesSection'),
      };
      function activate(name){
        tabs.forEach(t => t.classList.toggle('active', t.dataset.top === name));
        Object.entries(sections).forEach(([k,el]) => el.classList.toggle('active', k === name));
      }
      document.getElementById('topTabs').addEventListener('click', (ev) => {
        const btn = ev.target.closest('.top-tab');
        if (!btn) return;
        activate(btn.dataset.top);
      });
      // por defecto queda "matches"
      activate('matches');
    })();
  </script>
</body>
</html>